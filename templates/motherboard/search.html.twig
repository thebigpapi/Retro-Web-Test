{% extends 'base.html.twig' %}

{% form_theme form _self %}

{% block checkbox_widget %}
	{% set type = type|default('checkbox') %}
	<input type="{{ type }}" {{ block('widget_attributes') }} {% if value is not empty %} value="{{ value }}" {% endif %}>
{% endblock %}

{% block hidden_widget %}
	{% set type = type|default('hidden') %}
	<input type="{{ type }}" {{ block('widget_attributes') }} {% if value is not empty %} value="{{ value }}" {% endif %}>
{% endblock %}

{% block title %}Search boards - TRW{% endblock %}

{% block metatags %}
	<meta name="description" content="Search for a motherboard by name, chipset, manufacturer, CPU family, form factor, expansion slot count and more.">
	<link rel="alternate" hreflang="x-default" href="{{ absolute_url(path('mobosearch')) }}"/>
{% endblock %}
{% block body %}
	{# <div class="index-title">
		List boards whose manufacturer name starts with:<br>
	</div>
	<div class="index-list">
		{% for letter in ['A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z','?']%}
			<a class="index-letter" href="{{path("moboindex", {"letter":letter})}}">{{letter}}</a>
		{% endfor %}
	</div> #}
	
	{{ form_start(form, {'method': 'POST', 'name': 'search_motherboard', 'action': path("mobosearch"),
						 'attr': {'data-controller': 'search', 'data-live-action': path('mobolivewrapper')}}) }}
	<fieldset id="search-fieldset">
		<div class="title">Search for a motherboard</div>
		<section class="search-form-grid">
			<div class="search-form-entry">
				<label class="search-form-label" for="search_name" title="This is where you enter the board part number, do not write the manufacturer name here!">
					<span>Manufacturer and name</span>
					<img src="{{ absolute_url(asset('build/icons/search/help.svg')) }}" alt="" width="16" height="16">
				</label>
				<div class="search-form-widget">
					<div id="setmanuf">{{ form_widget(form.manufacturer, {'attr': {'aria-label': "Manufacturer", 'data-target-id': 'search_manufacturer'}}) }}</div>
					<div>{{ form_widget(form.name, {'attr': {'placeholder': 'Name or Part number (without manufacturer) ...'}}) }}</div>
				</div>
			</div>

			<div class="search-form-entry">
				<label class="search-form-label" for="search_chipset" title="Select a manufacturer from the first field, then pick the part number from the second field">
					<span>Chipset</span>
					<img src="{{ absolute_url(asset('build/icons/search/help.svg')) }}" alt="" width="16" height="16">
				</label>
				<div class="search-form-widget">
					<div id="setchip1">{{ form_widget(form.chipsetManufacturer, {'attr': {'data-action': "change->search#search", 'data-target-id': 'search_chipset', 'aria-label': "Chipset manufacturer"}}) }}</div>
					<div>{{ form_widget(form.chipset) }}</div>
				</div>
			</div>

			<div class="search-form-entry">
				<label class="search-form-label" for="search_cpuSocket1" title="Select a CPU socket from the first field and/or pick the CPU family from the second field">
					<span>CPU socket</span>
					<img src="{{ absolute_url(asset('build/icons/search/help.svg')) }}" alt="" width="16" height="16">
				</label>
				<div class="search-form-widget">
					<div id="setcpu1">{{ form_widget(form.cpuSocket1, {'attr': {'data-target-id': 'search_platform1'}}) }}</div>
					<div id="setcpup1">{{ form_widget(form.platform1, {'attr': {'aria-label': "CPU family"}}) }}</div>
				</div>
			</div>

			<div class="search-form-entry">
				<label class="search-form-label" for="search_cpuSocket2">
					<span>2nd CPU socket</span>
				</label>
				<div class="search-form-widget">
					<div id="setcpu3">{{ form_widget(form.cpuSocket2, {'attr': {'data-action': "change->search#search", 'data-target-id': 'search_platform2'}}) }}</div>
					<div id="setcpup3">{{ form_widget(form.platform2, {'attr': {'aria-label': "Secondary CPU family"}}) }}</div>
				</div>
			</div>

			<div class="search-form-entry">
				<label class="search-form-label" for="search_formFactor" title="">
					<span>Form factor</span>
				</label>
				<div class="search-form-widget">
					<div id="setformf">{{ form_widget(form.formFactor) }}</div>
				</div>
			</div>
		</section>

		<section class="search-form-grid">
			<div class="search-form-filter" data-controller="collection">
				<label class="search-form-label" title="">
					<span>Expansion slots</span>
					{% include 'macros/buttons.html.twig' with {'type':'add', 'action': 'motherboardExpansionSlots'} %}
				</label>
				<div class="search-form-widget filter-list" id="motherboardExpansionSlots-fields-list" data-widget-counter="{{ form.motherboardExpansionSlots|length }}" data-prototype="
					{{ form_widget(form.motherboardExpansionSlots.vars.prototype.count, {'attr': {'class': 'num'}} )|e }} x
					{{ form_widget(form.motherboardExpansionSlots.vars.prototype.expansion_slot)|e  }}
					{% include 'macros/buttons.html.twig' with {'type':'del'} %}" data-controller="collection">
					{% for slot in form.motherboardExpansionSlots %}
						<div class="editor-row">
							{{ form_widget(slot.count, {'attr': {'class': 'num'}}) }} x
							{{ form_widget(slot.expansion_slot, {'attr': {'style': 'width:50%'}}) }}
							{% include 'macros/buttons.html.twig' with {'type':'del'} %}
						</div>
						{{ form_errors(slot.count) }}
					{% endfor %}
				</div>
			</div>

			<div class="search-form-filter" data-controller="collection">
				<label class="search-form-label" title="">
					<span>I/O ports</span>
					{% include 'macros/buttons.html.twig' with {'type':'add', 'action': 'motherboardIoPorts'} %}
				</label>
				<div class="search-form-widget filter-list" id="motherboardIoPorts-fields-list" data-widget-counter="{{ form.motherboardIoPorts|length }}" data-prototype="
					{{ form_widget(form.motherboardIoPorts.vars.prototype.count, {'attr': {'class': 'num'}} )|e }} x
					{{ form_widget(form.motherboardIoPorts.vars.prototype.io_port)|e }}
					{% include 'macros/buttons.html.twig' with {'type':'del'} %}" data-controller="collection">
					{% for port in form.motherboardIoPorts %}
						<div class="editor-row">
							{{ form_widget(port.count, {'attr': {'class': 'num'}}) }} x
							{{ form_widget(port.io_port, {'attr': {'style': 'width:50%'}}) }}
							{% include 'macros/buttons.html.twig' with {'type':'del'} %}
						</div>
						{{ form_errors(port.count) }}
					{% endfor %}
				</div>
			</div>

			<div class="search-form-filter" data-controller="collection">
				<label class="search-form-label" title="">
					<span>Expansion chips</span>
					{% include 'macros/buttons.html.twig' with {'type':'add', 'action': 'expansionChips'} %}
				</label>
				<div class="search-form-widget filter-list" id="expansionChips-fields-list" data-widget-counter="{{ form.expansionChips|length }}" data-prototype="
					{{ form_widget(form.expansionChips.vars.prototype, {'attr': {'style': 'width:50%'}})|e }}
					{% include 'macros/buttons.html.twig' with {'type':'del'} %}</div>" data-controller="collection">
					{% for expchip in form.expansionChips %}
						<div class="editor-row">
							{{ form_widget(expchip, {'attr': {'style': 'width:50%'}}) }}
							{% include 'macros/buttons.html.twig' with {'type':'del'} %}
							{{ form_errors(expchip) }}
						</div>
					{% endfor %}
				</div>
			</div>
		</section>

		<section class="search-form-grid search-form-grid-tight">
			<div class="search-form-header">Search results options</div>
			<div class="search-form-entry">
				<label class="search-form-label file" title="If unchecked, only show board models, without any thumbnail.">
					<span>Show images</span>
					<img src="{{ absolute_url(asset('build/icons/search/help.svg')) }}" alt="" width="16" height="16">
				</label>
				<label class="search-form-widget">
					{{ form_widget(form.searchWithImages, {'attr': {'style': 'width:25px;height:25px'}}) }}
					<span class="slider"></span>
				</label>
			</div>

			<div class="search-form-entry">
				<label class="search-form-label">
					<span>Items per page</span>
				</label>
				<div class="search-form-widget">
					<div>{{ form_widget(form.itemsPerPage) }}</div>
				</div>
			</div>
		</section>

		<!-- Search toolbar -->
		<div class="toolbar toolbar-main">
			<button type="button" onclick="document.getElementById('rst-btn').click();return false;">
				<img src="{{ absolute_url(asset('build/icons/search/reset.svg')) }}" alt="reset" width="24" height="24">
				<span>Reset fields</span>
			</button>
			<button type="button" onclick="paginate(1)">
				<img src="{{ absolute_url(asset('build/icons/search/search.svg')) }}" alt="search" width="24" height="24">
				<span>Search</span>
			</button>
			<input id="rst-btn" type="reset" value="reset" data-reset-ids='search_chipsetManufacturer search_cpuSocket1 search_cpuSocket2'>
			<input id="pagination_redir" type="button" value="" data-results-id='search_moboResults' value="1">
			<script>
				function paginate(newPageIdx) {
				console.debug("setting paginator " + newPageIdx);
				var redirElem = document.getElementById('pagination_redir');
				if (redirElem) {
					redirElem.setAttribute("value", newPageIdx);
					if(el = document.getElementById("route-results"))
						el.remove();
					window.history.replaceState({},'', window.origin + '/motherboards/');
					redirElem.click();
				}
				return false;
			}
			</script>
		</div>
	</fieldset>
	{{ form_end(form, {render_rest: false}) }}

	<!-- Search results -->
	<section id="search_moboResults">
	{% if motherboards is defined %}
		<div id="route-results">
			{% include 'motherboard/result.html.twig' with {'motherboards': motherboards, 'motherboard_count': motherboard_count, 'show_images': show_images} %}
		</div>
	{% endif %}

	</section>

</form>{% endblock %}
