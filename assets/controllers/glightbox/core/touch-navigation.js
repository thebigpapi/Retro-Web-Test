import e from"./touch-events.js";import{addEvent as t,addClass as i,removeClass as l,hasClass as r,closest as n,whichTransitionEvent as a,cssTransform as o,windowSize as s}from"../utils/helpers.js";function resetSlideMove(e){let s=a(),g=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,u=r(e,"gslide-media")?e:e.querySelector(".gslide-media"),c=n(u,".ginner-container"),d=e.querySelector(".gslide-description");g>769&&(u=c),i(u,"greset"),o(u,"translate3d(0, 0, 0)"),t(s,{onElement:u,once:!0,withCallback(e,t){l(u,"greset")}}),u.style.opacity="",d&&(d.style.opacity="")}export default function g(t){if(t.events.hasOwnProperty("touch"))return!1;let a=s(),g=a.width,u=a.height,c=!1,d=null,$=null,h=null,p=!1,_=1,f=1,y=!1,m=!1,S=null,v=null,T=null,X=null,b,x,Y=0,w=0,q=!1,W=!1,E={},M={},A=0,j=0,z,C=document.getElementById("glightbox-slider"),F=document.querySelector(".goverlay"),L=new e(C,{touchStart(e){if(c=!0,(r(e.targetTouches[0].target,"ginner-container")||n(e.targetTouches[0].target,".gslide-desc")||"a"==e.targetTouches[0].target.nodeName.toLowerCase())&&(c=!1),n(e.targetTouches[0].target,".gslide-inline")&&!r(e.targetTouches[0].target.parentNode,"gslide-inline")&&(c=!1),c){M=e.targetTouches[0],E.pageX=e.targetTouches[0].pageX,E.pageY=e.targetTouches[0].pageY,A=e.targetTouches[0].clientX,j=e.targetTouches[0].clientY,$=(d=t.activeSlide).querySelector(".gslide-media"),z=d.querySelector(".gslide-inline"),h=null,r($,"gslide-image")&&(h=$.querySelector("img"));let i=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;i>769&&($=d.querySelector(".ginner-container")),l(F,"greset"),(!(e.pageX>20)||!(e.pageX<window.innerWidth-20))&&e.preventDefault()}},touchMove(e){if(!c||(M=e.targetTouches[0],y||m))return;if(z&&z.offsetHeight>u){let i=E.pageX-M.pageX;if(13>=Math.abs(i))return!1}p=!0;let l=e.targetTouches[0].clientX,r;Math.abs(A-l)>Math.abs(j-e.targetTouches[0].clientY)?(q=!1,W=!0):(W=!1,q=!0),Y=100*(b=M.pageX-E.pageX)/g,w=100*(x=M.pageY-E.pageY)/u;let n;if(q&&h&&(n=1-Math.abs(x)/u,F.style.opacity=n,t.settings.touchFollowAxis&&(Y=0)),W&&(n=1-Math.abs(b)/g,$.style.opacity=n,t.settings.touchFollowAxis&&(w=0)),!h)return o($,`translate3d(${Y}%, 0, 0)`);o($,`translate3d(${Y}%, ${w}%, 0)`)},touchEnd(){if(!c)return;if(p=!1,m||y){T=S,X=v;return}let e=Math.abs(parseInt(w)),l=Math.abs(parseInt(Y));if(e>29&&h){window.history.go(-1),t.close();return}if(e<29&&l<25)return i(F,"greset"),F.style.opacity=1,resetSlideMove($)},multipointEnd(){setTimeout(()=>{y=!1},50)},multipointStart(){y=!0,_=f||1},pinch(e){if(!h||p)return!1;y=!0,h.scaleX=h.scaleY=_*e.zoom;let t=_*e.zoom;if(m=!0,t<=1){m=!1,t=1,X=null,T=null,S=null,v=null,h.setAttribute("style","");return}t>4.5&&(t=4.5),h.style.transform=`scale3d(${t}, ${t}, 1)`,f=t},pressMove(e){if(m&&!y){var t=M.pageX-E.pageX,i=M.pageY-E.pageY;T&&(t+=T),X&&(i+=X),S=t,v=i;let l=`translate3d(${t}px, ${i}px, 0)`;f&&(l+=` scale3d(${f}, ${f}, 1)`),o(h,l)}},swipe(e){if(!m){if(y){y=!1;return}if("Left"==e.direction){if(t.index==t.elements.length-1)return resetSlideMove($);t.nextSlide()}if("Right"==e.direction){if(0==t.index)return resetSlideMove($);t.prevSlide()}}}});t.events.touch=L};